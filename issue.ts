#!/usr/bin/env -S node --experimental-strip-types --disable-warning=ExperimentalWarning

import { createClient } from "smartsheet";

const sheetId = 3028600315924356;
const columnId = 7909615123779460;

const accessToken = process.env["TOKEN"] ?? "missing!!";

async function run(id: number) {
  const client = createClient({
    accessToken,
    logLevel: "verbose",
    // baseUrl: "http://localhost:8080/2.0/",
  });
  await client.sheets["updateRow"]({
    sheetId,
    body: {
      id,
      cells: [
        {
          columnId,
          value: new Date().toISOString(),
        },
      ],
    },
  });
}

const nparallel = 32; // max: 100
await Promise.race(rowIds().slice(0, nparallel).map(run));

// data

function rowIds(): number[] {
  return [
    7455288388358020,
    5856851884642180,
    1835495480233860,
    5029125787357060,
    6610893522997124,
    4434775328034692,
    2201972154699652,
    7531030136622980,
    107488403132292,
    5034163783995268,
    8302767040237444,
    195981909299076,
    3296877430050692,
    5543662869417860,
    8434347658317700,
    1449614143524740,
    1276630040711044,
    2480732712079236,
    2170977523208068,
    7161027294007172,
    5588914644848516,
    7349907070783364,
    3711699330142084,
    502963623038852,
    8203273049083780,
    8078822076714884,
    451630173917060,
    5006563250409348,
    6714814551691140,
    1494053096394628,
    4166948683648900,
    6822377712652164,
    6731650823491460,
    6452884897402756,
    4735997490630532,
    629928225017732,
    2447896613359492,
    1029547014623108,
    1104860339900292,
    29027940568964,
    7067620345253764,
    5084293568532356,
    4651223426142084,
    6644079661551492,
    4227719249661828,
    4334328927883140,
    2371463375359876,
    6201256722173828,
    4359235443232644,
    5613923165671300,
    5310493389885316,
    359637343145860,
    4649931714727812,
    1152826534662020,
    6435292711358340,
    6875166081945476,
    7684922036064132,
    299218964451204,
    1993825154633604,
    6395681301729156,
    4864502912126852,
    8180518312349572,
    1486803191598980,
    4667837433384836,
    6955868517437316,
    7990612038389636,
    8505183480188804,
    3187335362908036,
    6739470885195652,
    7427662084968324,
    6741180282179460,
    1979132071513988,
    6663300713942916,
    6120391077924740,
    8372190891609988,
    3045366292680580,
    5531683131887492,
    6153912223928196,
    8699487800659844,
    292656254422916,
    6894627652505476,
    8405712037613444,
    5827322910740356,
    406778904186756,
    1203696127315844,
    3226479694843780,
    5826052674162564,
    2679606877753220,
    3120333873090436,
    4642647450193796,
    1527038445227908,
    2004346750766980,
    28051909250948,
    6930837448036228,
    7651962457034628,
    3088370726473604,
    7503992243752836,
    1874492709539716,
    79093300596612,
    4347852706156420,
  ];
}
